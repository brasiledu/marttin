{% extends "base.html" %}
{% load static %}

{% block title %}Dashboard - Marttin AI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'agent/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<!-- KPI cards -->
<div class="kpi-grid">
  <div class="kpi-card">
    <div class="kpi-header">
      <span>Faturamento do Mês</span>
      <i class="bi bi-cash-coin"></i>
    </div>
    <div class="kpi-value" id="kpiFaturamento">R$ 125.430</div>
    <div class="kpi-trend up"><i class="bi bi-arrow-up-right"></i> +8,4% vs mês anterior</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-header">
      <span>Novos Clientes</span>
      <i class="bi bi-people"></i>
    </div>
    <div class="kpi-value" id="kpiNovosClientes">87</div>
    <div class="kpi-trend up"><i class="bi bi-arrow-up-right"></i> +12,1%</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-header">
      <span>CAC</span>
      <i class="bi bi-graph-down"></i>
    </div>
    <div class="kpi-value" id="kpiCAC">R$ 62,50</div>
    <div class="kpi-trend down"><i class="bi bi-arrow-down-right"></i> -5,3%</div>
  </div>
</div>

<!-- Charts -->
<div class="charts-grid">
  <div class="widget">
    <div class="widget-header">
      <h3>Fluxo de Caixa (30 dias)</h3>
    </div>
    <canvas id="cashflowChart" height="120"></canvas>
  </div>
  <div class="widget">
    <div class="widget-header">
      <h3>Vendas por Canal</h3>
    </div>
    <canvas id="channelChart" height="120"></canvas>
  </div>
</div>

<!-- Table -->
<div class="widget">
  <div class="widget-header">
    <h3>Últimas Vendas Realizadas</h3>
  </div>
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Data</th>
          <th>Cliente</th>
          <th>Canal</th>
          <th>Valor</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="latestSalesBody">
        <tr>
          <td>1</td>
          <td>25/10/2025</td>
          <td>Maria Oliveira</td>
          <td>Loja Online</td>
          <td>R$ 1.290,00</td>
          <td><span class="status ok">Pago</span></td>
        </tr>
        <tr>
          <td>2</td>
          <td>25/10/2025</td>
          <td>João Lima</td>
          <td>Marketplace</td>
          <td>R$ 349,90</td>
          <td><span class="status ok">Pago</span></td>
        </tr>
        <tr>
          <td>3</td>
          <td>24/10/2025</td>
          <td>Aline Souza</td>
          <td>Instagram</td>
          <td>R$ 179,00</td>
          <td><span class="status pending">Pendente</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Insights do Estrategista -->
<div class="widget">
  <div class="widget-header">
    <h3>Recomendações do Marttin</h3>
  </div>
  <div id="insightsContainer" class="insights">
    <div class="insight">
      <i class="bi bi-lightbulb"></i>
      <div>
        <strong>Campanhas com melhor ROI</strong>
        <p>Direcione mais orçamento para o canal Instagram Ads, que apresentou CAC 15% menor na última semana.</p>
      </div>
    </div>
    <div class="insight">
      <i class="bi bi-graph-up"></i>
      <div>
        <strong>Fluxo de caixa</strong>
        <p>Atenção aos próximos 10 dias: previsão de pico de despesas. Considere antecipar recebíveis.</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal Upload de Dados (placeholder) -->
<div class="modal" id="uploadModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-header">
      <h4>Enviar Planilha</h4>
      <button class="icon-btn" data-close-modal><i class="bi bi-x"></i></button>
    </div>
    <div class="modal-body">
      <p>Envie um arquivo CSV/XLS/XLSX para análise pelo agente de dados.</p>
      <form id="uploadForm">
        <input type="file" id="dataFile" accept=".csv,.xls,.xlsx">
        <button type="submit" class="btn-primary"><i class="bi bi-cloud-upload"></i> Enviar</button>
      </form>
      <div class="form-hint">Este fluxo apenas prepara o hook. Integração com backend virá em seguida.</div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'agent/js/dashboard.js' %}"></script>
{% endblock %}
